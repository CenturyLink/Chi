var __spreadArray=this&&this.__spreadArray||function(t,i,s){if(s||arguments.length===2)for(var e=0,n=i.length,h;e<n;e++){if(h||!(e in i)){if(!h)h=Array.prototype.slice.call(i,0,e);h[e]=i[e]}}return t.concat(h||Array.prototype.slice.call(i))};import{r as registerInstance,c as createEvent,h,g as getElement}from"./index-422a57bb.js";import{g as CHECKBOX_CLASSES,U as UTILITY_CLASSES,h as DROPDOWN_CLASSES,i as DIVIDER_CLASSES}from"./classes-d4369523.js";import{v as v4}from"./v4-a4ec28c0.js";var DropdownSelect=function(){function t(t){registerInstance(this,t);this.eventValueChanged=createEvent(this,"chiDropdownValueChanged",7);this.active=false;this.button="Open dropdown";this.search=false;this.showSelected=false;this.multiple=false;this.disabled=false;this.currentItems=[];this.filteredItems=[];this.searchValue="";this.showSelectedOnly=false;this.id=v4();this.currentDirtyItems=[];this.isSearchMode=this.search||this.showSelected}t.prototype.componentDidLoad=function(){if(this.isSearchMode){this.dropdownElement.retainSelection=false}this.addSearchInputListeners();this.addCheckboxListeners()};t.prototype.addSearchInputListeners=function(){var t=this;this.searchInputElement=this.el.querySelector("chi-search-input");if(this.searchInputElement){this.handleSearchInput=function(i){t.searchValue=i.detail;t.applyFilters()};this.handleSearchClean=function(){t.searchValue="";t.applyFilters()};this.searchInputElement.addEventListener("chiInput",this.handleSearchInput);this.searchInputElement.addEventListener("chiClean",this.handleSearchClean)}};t.prototype.addCheckboxListeners=function(){var t=this;this.selectOnlyCheckbox=this.el.querySelector("#checkbox-select");if(this.selectOnlyCheckbox){this.handleCheckboxChange=function(i){t.showSelectedOnly=i.detail;t.applyFilters()};this.selectOnlyCheckbox.addEventListener("chiChange",this.handleCheckboxChange)}};t.prototype.componentWillLoad=function(){this.setCurrentDirtyItems()};t.prototype.disconnectedCallback=function(){if(this.searchInputElement){this.searchInputElement.removeEventListener("chiInput",this.handleSearchInput);this.searchInputElement.removeEventListener("chiClean",this.handleSearchClean)}if(this.selectOnlyCheckbox){this.selectOnlyCheckbox.removeEventListener("chiChange",this.handleCheckboxChange)}};t.prototype.setCurrentDirtyItems=function(){var t=this;var i,s;this.currentDirtyItems=(s=(i=this.items)===null||i===void 0?void 0:i.map((function(i,s){return Object.assign(Object.assign({},i),{id:i.id||t.id+"-"+s})})))!==null&&s!==void 0?s:[];this.applyFilters()};t.prototype.resetFilters=function(){this.searchValue="";this.searchInputElement&&(this.searchInputElement.value="");this.showSelectedOnly=false;this.selectOnlyCheckbox&&this.selectOnlyCheckbox.removeAttribute("checked");this.filteredItems=__spreadArray([],this.currentDirtyItems,true)};t.prototype.applyFilters=function(){var t=this;var i=this.searchValue||"";var s=i.toLowerCase();this.filteredItems=this.currentDirtyItems.filter((function(e){var n=e.label.toLowerCase();var h=i===""||n.includes(s);var r=!t.showSelectedOnly||e.checked;return h&&r}))};t.prototype.handleItemClick=function(t,i){t.stopPropagation();i.checked=!i.checked;if(this.showSelectedOnly){this.applyFilters()}};t.prototype.handleApply=function(){this.dropdownElement.hide();this.currentItems=this.currentDirtyItems.filter((function(t){return t.checked}));this.resetFilters();this.eventValueChanged.emit(this.currentDirtyItems)};t.prototype.handleClear=function(){var t=Array.from(this.el.querySelectorAll("".concat(CHECKBOX_CLASSES.checkbox,"[checked]")));t.forEach((function(t){return t.removeAttribute("checked")}));this.currentDirtyItems.forEach((function(t){return t.checked=false}));this.showSelectedOnly=false;this.applyFilters();this.eventValueChanged.emit(this.currentDirtyItems)};t.prototype.getButtonContent=function(){return this.currentItems.length?"(".concat(this.currentItems.length,") ").concat(this.button):this.button};t.prototype.renderItems=function(){if(!this.isSearchMode||!this.currentDirtyItems.length)return null;if(!this.filteredItems.length){return this.renderNoResults()}return this.renderFilteredItems()};t.prototype.renderNoResults=function(){return h("div",{slot:"menu",class:"".concat(DROPDOWN_CLASSES.MENU_ITEM," ").concat(UTILITY_CLASSES.TYPOGRAPHY.TEXT_ITALIC)},"No results")};t.prototype.renderFilteredItems=function(){var t=this;return this.filteredItems.map((function(i){return t.renderCheckbox(i)}))};t.prototype.renderCheckbox=function(t){var i=this;return h("chi-checkbox",{label:t.label,class:DROPDOWN_CLASSES.MENU_ITEM,checked:t.checked||null,name:"".concat(this.id,"-group"),id:t.id,key:t.id,slot:"menu",onChiChange:function(s){return i.handleItemClick(s,t)}})};t.prototype.renderSearchModeFooter=function(){var t=this;if(!this.filteredItems.length)return null;var i=[UTILITY_CLASSES.DISPLAY.FLEX,UTILITY_CLASSES.JUSTIFY.END,UTILITY_CLASSES.PADDING[1],UTILITY_CLASSES.PADDING.RIGHT[2]].join(" ");return[h("div",{slot:"menu-footer",class:DIVIDER_CLASSES.DIVIDER}),h("div",{slot:"menu-footer",class:i},h("chi-button",{size:"xs",class:UTILITY_CLASSES.MARGIN.RIGHT[1],onClick:function(){return t.handleClear()}},"Clear"),h("chi-button",{size:"xs",color:"primary",onClick:function(){return t.handleApply()}},"Apply"))]};t.prototype.renderSearchModeElements=function(){if(!this.isSearchMode)return null;return[this.search&&h("chi-search-input",{placeholder:"Search",slot:"menu-header"}),this.showSelected&&h("chi-checkbox",{class:DROPDOWN_CLASSES.MENU_ITEM,slot:"menu-header",id:"checkbox-select",label:"Show selected only"}),h("div",{class:"chi-divider",slot:"menu-header"})].filter(Boolean)};t.prototype.resetDirtyItems=function(){this.resetFilters();var t=this.currentItems.map((function(t){return t.id}));this.currentDirtyItems.forEach((function(i){var s=document.getElementById(i.id);var e=t.includes(i.id);i.checked=e;s&&(e?s.setAttribute("checked",""):s.removeAttribute("checked"))}))};t.prototype.renderSlots=function(){return[h("slot",{name:"menu-header"}),h("slot",{name:"menu"}),h("slot",{name:"menu-footer"})]};t.prototype.render=function(){var t=this;var i={id:this.id,active:this.active,disabled:this.disabled,size:this.size,state:this.state,visibleItems:this.visibleItems,helperMessage:this.helperMessage,button:this.getButtonContent()};var s={preventAutoHide:this.isSearchMode,preventItemSelected:this.isSearchMode,"select-mode":this.isSearchMode||this.multiple?"multi":"single",onChiDropdownHide:function(){return t.isSearchMode&&t.resetDirtyItems()},onChiDropdownValueChanged:function(i){return t.isSearchMode&&i.stopPropagation()}};return h("chi-dropdown",Object.assign({key:"dab6939fae57fb9e6236ff3093e83b13a54de743"},i,s,{ref:function(i){return t.dropdownElement=i}}),this.renderSearchModeElements(),this.renderItems(),this.renderSearchModeFooter(),this.renderSlots())};Object.defineProperty(t.prototype,"el",{get:function(){return getElement(this)},enumerable:false,configurable:true});Object.defineProperty(t,"watchers",{get:function(){return{items:["setCurrentDirtyItems"]}},enumerable:false,configurable:true});return t}();export{DropdownSelect as chi_dropdown_select};