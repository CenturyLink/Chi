var __awaiter=this&&this.__awaiter||function(t,i,s,e){function n(t){return t instanceof s?t:new s((function(i){i(t)}))}return new(s||(s=Promise))((function(s,h){function r(t){try{c(e.next(t))}catch(t){h(t)}}function a(t){try{c(e["throw"](t))}catch(t){h(t)}}function c(t){t.done?s(t.value):n(t.value).then(r,a)}c((e=e.apply(t,i||[])).next())}))};var __generator=this&&this.__generator||function(t,i){var s={label:0,sent:function(){if(h[0]&1)throw h[1];return h[1]},trys:[],ops:[]},e,n,h,r;return r={next:a(0),throw:a(1),return:a(2)},typeof Symbol==="function"&&(r[Symbol.iterator]=function(){return this}),r;function a(t){return function(i){return c([t,i])}}function c(a){if(e)throw new TypeError("Generator is already executing.");while(r&&(r=0,a[0]&&(s=0)),s)try{if(e=1,n&&(h=a[0]&2?n["return"]:a[0]?n["throw"]||((h=n["return"])&&h.call(n),0):n.next)&&!(h=h.call(n,a[1])).done)return h;if(n=0,h)a=[a[0]&2,h.value];switch(a[0]){case 0:case 1:h=a;break;case 4:s.label++;return{value:a[1],done:false};case 5:s.label++;n=a[1];a=[0];continue;case 7:a=s.ops.pop();s.trys.pop();continue;default:if(!(h=s.trys,h=h.length>0&&h[h.length-1])&&(a[0]===6||a[0]===2)){s=0;continue}if(a[0]===3&&(!h||a[1]>h[0]&&a[1]<h[3])){s.label=a[1];break}if(a[0]===6&&s.label<h[1]){s.label=h[1];h=a;break}if(h&&s.label<h[2]){s.label=h[2];s.ops.push(a);break}if(h[2])s.ops.pop();s.trys.pop();continue}a=i.call(t,s)}catch(t){a=[6,t];n=0}finally{e=h=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};import{r as registerInstance,c as createEvent,h,g as getElement}from"./index-422a57bb.js";import{c as contains}from"./utils-48628cb4.js";import{E as ESCAPE_KEYCODE,b as CHI_TIME_AUTO_SCROLL_DELAY}from"./constants-e61c7d0c.js";import{d as dayjs,c as customParseFormat}from"./customParseFormat-56df63e5.js";import{f as TIME_CLASSES}from"./classes-d4369523.js";import{C as CHI_STATES}from"./states-a5be3f93.js";import{a as addMutationObserver}from"./mutationObserver-46245962.js";import{v as v4}from"./v4-a4ec28c0.js";var DatePicker=function(){function t(t){registerInstance(this,t);this.eventChange=createEvent(this,"chiDateChange",7);this.eventInvalid=createEvent(this,"chiDateInvalid",7);this.locale="en";this.min="01/01/1900";this.max="12/31/2099";this.format="MM/DD/YYYY";this.disabled=false;this.active=false;this.mode="date";this.multiple=false;this.timeFormat="12hr";this.displaySeconds=false;this.excludedWeekdaysArray=[];this.excludedDatesArray=[]}t.prototype.stateValidation=function(t){var i=CHI_STATES.join(", ");if(t&&!CHI_STATES.includes(t)){throw new Error("".concat(t," is not a valid state for date picker. If provided, valid values are: ").concat(i,". "))}};t.prototype.updateExcludedDates=function(){this.excludedDatesArray=this.excludedDates?this.excludedDates.split(",").map((function(t){return t.trim()})):[]};t.prototype.updateExcludedWeekdays=function(){this.excludedWeekdaysArray=this.excludedWeekdays?this.excludedWeekdays.split(",").map((function(t){return parseInt(t)})):[]};t.prototype._onFocusIn=function(t){if(t.target!==document.body&&t.target!==null){this.active=contains(this.el,t.target)}};t.prototype._onClick=function(t){if(t.target!==document.body&&t.target!==null&&!(this.mode!=="datetime"&&!this.multiple&&new RegExp("(\\s|^)"+"chi-datepicker__day"+"(\\s|$)").test(t.target.getAttribute("class")))){this.active=contains(this.el,t.target)}};t.prototype._isEscapeKey=function(t){return"key"in t&&(t.key==="Escape"||t.key==="Esc"||t.key===ESCAPE_KEYCODE)};t.prototype._onKeyUp=function(t){if(!this.active)return;if(this._isEscapeKey(t)){this.active=false;this._input.blur()}};t.prototype.checkIfExcluded=function(t){return this.excludedDates&&this.excludedDatesArray.some((function(i){return dayjs(i).startOf("day").isSame(t.startOf("day"))}))||this.excludedWeekdays&&this.excludedWeekdaysArray.includes(t.day())};t.prototype._checkValidDate=function(t,i,s){var e=dayjs(t,this.format);return e.isValid()&&!this.checkIfExcluded(e)&&!e.startOf("day").isBefore(dayjs(i).startOf("day"))&&!e.startOf("day").isAfter(dayjs(s).startOf("day"))};t.prototype._checkMultipleDates=function(t,i){var s=this;var e=this._input.value.replace(/ /g,"").split(",");var n=[];e.forEach((function(e){if(s._checkValidDate(e,t,i)&&!n.includes(e)){n.push(e)}}));this.value=n.join(",");this._input.value=this.value;this.eventChange.emit(this.value)};t.prototype._checkSingleDate=function(t,i){var s=dayjs(this._input.value,this.format);var e=this.mode==="datetime";var n=e?this._input.value.split(", ")[1]:"";var h=e?this._input.value.split(", ")[0]:this._input.value;if(dayjs(h,this.format,true).isValid()&&!this.checkIfExcluded(s)){if(dayjs(s).startOf("day").isBefore(dayjs(t).startOf("day"))){this.value=n?"".concat(this.min,", ").concat(n):this.min;this._input.value=this.value;this.eventChange.emit(this.value)}else if(dayjs(s).startOf("day").isAfter(dayjs(i).startOf("day"))){this.value=n?"".concat(this.max,", ").concat(n):this.max;this._input.value=this.value;this.eventChange.emit(this.value)}else{this.value=this._input.value;this.eventChange.emit(this.value)}}else{this.eventInvalid.emit(this._input.value);this.value="";this._input.value=""}};t.prototype._checkDate=function(){dayjs.locale(this.locale);dayjs.extend(customParseFormat);var t=dayjs(this.min,this.format);var i=dayjs(this.max,this.format);if(this._input.value===this.value){return}if(this.multiple){this._checkMultipleDates(t,i)}else{this._checkSingleDate(t,i)}};t.prototype.setDate=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(i){this.value=t;return[2]}))}))};t.prototype.resetDate=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){this.value=null;return[2]}))}))};t.prototype.getDate=function(){return Promise.resolve(this.value)};t.prototype.handlePopoverOpen=function(t){var i=this;t.stopPropagation();var s=this.el.querySelector(".".concat(TIME_CLASSES.HOURS));var e=this.el.querySelector(".".concat(TIME_CLASSES.MINUTES));var n=this.el.querySelector(".".concat(TIME_CLASSES.SECONDS));setTimeout((function(){if(s){var t=s.querySelector(".".concat(TIME_CLASSES.HOUR,".-active"));if(t){s.scrollTop=t.offsetTop-12}}if(e){var h=e.querySelector(".".concat(TIME_CLASSES.MINUTE,".-active"));if(h){e.scrollTop=h.offsetTop-12}}if(i.displaySeconds&&n){var r=n.querySelector(".".concat(TIME_CLASSES.SECOND,".-active"));if(r){n.scrollTop=r.offsetTop-12}}}),CHI_TIME_AUTO_SCROLL_DELAY)};t.prototype.handleDateChange=function(t){t.stopPropagation();var i=t.detail;if(this.mode==="date"){this.value=i;this._input.value=i}if(this.mode==="datetime"&&this.time){var s=this.formatTime(this.time);this.value="".concat(i,", ").concat(s);this._input.value=this.value}if(!this.multiple){this.active=false;this._input.blur()}this.eventChange.emit(this.value)};t.prototype.handleTimeChange=function(t){t.stopPropagation();if(t.detail){var i=t.detail,s=i.hour,e=i.minute,n=i.second,h=i.period;this.time={hour:parseInt(s),minute:parseInt(e),second:parseInt(n),period:h}}if(!this.value){return}var r=this._getChiDateValue();var a=this.formatTime(t.detail);this.value="".concat(r,", ").concat(a);this.eventChange.emit(this.value)};t.prototype.formatTime=function(t){var i=this.timeFormat==="12hr"&&t.hour>12?t.hour-12:t.hour;var s=this.formatTimePeriod(i);var e=this.formatTimePeriod(t.minute);var n=this.displaySeconds?":".concat(this.formatTimePeriod(t.second)):"";return this.timeFormat==="12hr"?"".concat(s,":").concat(e).concat(n," ").concat(t.period):"".concat(s,":").concat(e).concat(n)};t.prototype.formatTimePeriod=function(t){return t.toString().length>1?t.toString():"0".concat(t)};t.prototype.connectedCallback=function(){addMutationObserver.call(this)};t.prototype.componentWillLoad=function(){this.stateValidation(this.state);this.updateExcludedDates();this.updateExcludedWeekdays();this._onFocusIn=this._onFocusIn.bind(this);this._onClick=this._onClick.bind(this);this._onKeyUp=this._onKeyUp.bind(this);this._uuid=this.el.id?this.el.id:"dp-".concat(v4())};t.prototype.componentDidLoad=function(){document.body.addEventListener("focusin",this._onFocusIn);document.body.addEventListener("click",this._onClick);document.body.addEventListener("keyup",this._onKeyUp)};t.prototype.disconnectedCallback=function(){document.body.removeEventListener("focusin",this._onFocusIn);document.body.removeEventListener("click",this._onClick);document.body.removeEventListener("keyup",this._onKeyUp)};t.prototype._getChiDateValue=function(){var t=this.value;if(this.mode==="datetime"){t=this.value?this.value.split(", ")[0]:null}return t};t.prototype._getPlaceholder=function(){if(this.mode!=="datetime"){return this.format}var t=this.displaySeconds?"--:--:--":"--:--";var i=this.timeFormat==="12hr"?" --":"";return"".concat(this.format,", ").concat(t).concat(i)};t.prototype.render=function(){var t=this;var i;var s=this._getChiDateValue();var e=h("chi-date",{key:"57e4928966e9e2f0c9fc024e51d5721c0b58e005",min:this.min,max:this.max,locale:this.locale,value:s,format:this.format,"excluded-weekdays":this.excludedWeekdays,"excluded-dates":this.excludedDates,multiple:this.multiple,onChiDateChange:function(i){return t.handleDateChange(i)}});var n=(((i=this.value)===null||i===void 0?void 0:i.split(", "))||[])[1];var r=this.mode==="datetime"?h("chi-time",{displaySeconds:this.displaySeconds,format:this.timeFormat,value:n,"minutes-step":this.minutesStep,onChiTimeChange:function(i){return t.handleTimeChange(i)}}):null;var a=this.mode==="datetime"?h("div",{class:"-d--flex"},e,r):e;var c=h("chi-popover",{key:"2e5f4f441f8c1b0758e516f00782ba35357342ec",id:"example-4-be-popover",position:this.mode==="datetime"?"bottom-start":"bottom",reference:"#".concat(this._uuid,"-control"),"prevent-auto-hide":true,active:this.active},a);var o="chi-input\n      ".concat(this.active?"-focus":"","\n      ").concat(this.state?"-"+this.state:"","\n    ");var u=this.helperMessage&&h("chi-helper-message",{key:"eec0f83fcd03b01ba1c9869694853a964cad4b80",state:this.state},this.helperMessage);return[h("div",{class:"\n        ".concat(this.disabled?"-disabled":"","\n        ").concat(this.mode==="datetime"?"-time":""),key:this._uuid},h("div",{key:"562be008fe486421c6ff48b84a07b0931ae1c9cc",class:"chi-input__wrapper -icon--right"},h("input",{key:"46f63cf2a64895917ded9854f6336fc158c2e0f6",id:"".concat(this._uuid,"-control"),class:o,type:"text",placeholder:this._getPlaceholder(),ref:function(i){return t._input=i},value:this.value&&this.multiple?String(this.value).replace(/,/g,", "):this.value,onChange:function(){t._checkDate()},disabled:this.disabled}),h("chi-icon",{key:"00d73873043e691f8d5b10f56a81ebb992ddc631",icon:"date"})),u,!this.disabled&&c)]};Object.defineProperty(t.prototype,"el",{get:function(){return getElement(this)},enumerable:false,configurable:true});Object.defineProperty(t,"watchers",{get:function(){return{state:["stateValidation"],excludedDates:["updateExcludedDates"],excludedWeekdays:["updateExcludedWeekdays"]}},enumerable:false,configurable:true});return t}();export{DatePicker as chi_date_picker};