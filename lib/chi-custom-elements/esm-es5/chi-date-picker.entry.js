var __awaiter=this&&this.__awaiter||function(t,i,s,e){function n(t){return t instanceof s?t:new s((function(i){i(t)}))}return new(s||(s=Promise))((function(s,a){function h(t){try{c(e.next(t))}catch(t){a(t)}}function r(t){try{c(e["throw"](t))}catch(t){a(t)}}function c(t){t.done?s(t.value):n(t.value).then(h,r)}c((e=e.apply(t,i||[])).next())}))};var __generator=this&&this.__generator||function(t,i){var s={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},e,n,a,h;return h={next:r(0),throw:r(1),return:r(2)},typeof Symbol==="function"&&(h[Symbol.iterator]=function(){return this}),h;function r(t){return function(i){return c([t,i])}}function c(r){if(e)throw new TypeError("Generator is already executing.");while(h&&(h=0,r[0]&&(s=0)),s)try{if(e=1,n&&(a=r[0]&2?n["return"]:r[0]?n["throw"]||((a=n["return"])&&a.call(n),0):n.next)&&!(a=a.call(n,r[1])).done)return a;if(n=0,a)r=[r[0]&2,a.value];switch(r[0]){case 0:case 1:a=r;break;case 4:s.label++;return{value:r[1],done:false};case 5:s.label++;n=r[1];r=[0];continue;case 7:r=s.ops.pop();s.trys.pop();continue;default:if(!(a=s.trys,a=a.length>0&&a[a.length-1])&&(r[0]===6||r[0]===2)){s=0;continue}if(r[0]===3&&(!a||r[1]>a[0]&&r[1]<a[3])){s.label=r[1];break}if(r[0]===6&&s.label<a[1]){s.label=a[1];a=r;break}if(a&&s.label<a[2]){s.label=a[2];s.ops.push(r);break}if(a[2])s.ops.pop();s.trys.pop();continue}r=i.call(t,s)}catch(t){r=[6,t];n=0}finally{e=a=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:true}}};import{r as registerInstance,c as createEvent,h,g as getElement}from"./index-93bc7bbf.js";import{c as contains}from"./utils-48628cb4.js";import{E as ESCAPE_KEYCODE,b as CHI_TIME_AUTO_SCROLL_DELAY}from"./constants-0e68989c.js";import{d as dayjs,c as customParseFormat}from"./customParseFormat-c15b4244.js";import{d as TIME_CLASSES}from"./classes-6227bd8c.js";import{C as CHI_STATES}from"./states-a5be3f93.js";import{a as addMutationObserver}from"./mutationObserver-b386bd11.js";import{v as v4}from"./v4-08967a5a.js";var DatePicker=function(){function t(t){registerInstance(this,t);this.eventChange=createEvent(this,"chiDateChange",7);this.eventInvalid=createEvent(this,"chiDateInvalid",7);this.locale="en";this.min="01/01/1900";this.max="12/31/2099";this.format="MM/DD/YYYY";this.disabled=false;this.active=false;this.mode="date";this.multiple=false;this.timeFormat="12hr";this.displaySeconds=false;this.excludedWeekdaysArray=[];this.excludedDatesArray=[]}t.prototype.stateValidation=function(t){var i=CHI_STATES.join(", ");if(t&&!CHI_STATES.includes(t)){throw new Error("".concat(t," is not a valid state for date picker. If provided, valid values are: ").concat(i,". "))}};t.prototype.updateExcludedDates=function(){this.excludedDatesArray=this.excludedDates?this.excludedDates.split(",").map((function(t){return t.trim()})):[]};t.prototype.updateExcludedWeekdays=function(){this.excludedWeekdaysArray=this.excludedWeekdays?this.excludedWeekdays.split(",").map((function(t){return parseInt(t)})):[]};t.prototype._onFocusIn=function(t){if(t.target!==document.body&&t.target!==null){this.active=contains(this.el,t.target)}};t.prototype._onClick=function(t){if(t.target!==document.body&&t.target!==null&&!(this.mode!=="datetime"&&!this.multiple&&new RegExp("(\\s|^)"+"chi-datepicker__day"+"(\\s|$)").test(t.target.getAttribute("class")))){this.active=contains(this.el,t.target)}};t.prototype._isEscapeKey=function(t){return"key"in t&&(t.key==="Escape"||t.key==="Esc"||t.key===ESCAPE_KEYCODE)};t.prototype._onKeyUp=function(t){if(!this.active)return;if(this._isEscapeKey(t)){this.active=false;this._input.blur()}};t.prototype.checkIfExcluded=function(t){return this.excludedDates&&this.excludedDatesArray.some((function(i){return dayjs(i).startOf("day").isSame(t.startOf("day"))}))||this.excludedWeekdays&&this.excludedWeekdaysArray.includes(t.day())};t.prototype._checkValidDate=function(t,i,s){var e=dayjs(t,this.format);return e.isValid()&&!this.checkIfExcluded(e)&&!e.startOf("day").isBefore(dayjs(i).startOf("day"))&&!e.startOf("day").isAfter(dayjs(s).startOf("day"))};t.prototype._checkMultipleDates=function(t,i){var s=this;var e=this._input.value.replace(/ /g,"").split(",");var n=[];e.forEach((function(e){if(s._checkValidDate(e,t,i)&&!n.includes(e)){n.push(e)}}));this.value=n.join(",");this._input.value=this.value;this.eventChange.emit(this.value)};t.prototype._checkSingleDate=function(t,i){var s=dayjs(this._input.value,this.format);var e=this.mode==="datetime";var n=e?this._input.value.split(", ")[1]:"";var a=e?this._input.value.split(", ")[0]:this._input.value;if(dayjs(a,this.format,true).isValid()&&!this.checkIfExcluded(s)){if(dayjs(s).startOf("day").isBefore(dayjs(t).startOf("day"))){this.value=n?"".concat(this.min,", ").concat(n):this.min;this._input.value=this.value;this.eventChange.emit(this.value)}else if(dayjs(s).startOf("day").isAfter(dayjs(i).startOf("day"))){this.value=n?"".concat(this.max,", ").concat(n):this.max;this._input.value=this.value;this.eventChange.emit(this.value)}else{this.value=this._input.value;this.eventChange.emit(this.value)}}else{this.eventInvalid.emit(this._input.value);this.value="";this._input.value=""}};t.prototype._checkDate=function(){dayjs.locale(this.locale);dayjs.extend(customParseFormat);var t=dayjs(this.min,this.format);var i=dayjs(this.max,this.format);if(this._input.value===this.value){return}if(this.multiple){this._checkMultipleDates(t,i)}else{this._checkSingleDate(t,i)}};t.prototype.setDate=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(i){this.value=t;return[2]}))}))};t.prototype.resetDate=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){this.value=null;return[2]}))}))};t.prototype.getDate=function(){return Promise.resolve(this.value)};t.prototype.handlePopoverOpen=function(t){var i=this;t.stopPropagation();var s=this.el.querySelector(".".concat(TIME_CLASSES.HOURS));var e=this.el.querySelector(".".concat(TIME_CLASSES.MINUTES));var n=this.el.querySelector(".".concat(TIME_CLASSES.SECONDS));setTimeout((function(){if(s){var t=s.querySelector(".".concat(TIME_CLASSES.HOUR,".-active"));if(t){s.scrollTop=t.offsetTop-12}}if(e){var a=e.querySelector(".".concat(TIME_CLASSES.MINUTE,".-active"));if(a){e.scrollTop=a.offsetTop-12}}if(i.displaySeconds&&n){var h=n.querySelector(".".concat(TIME_CLASSES.SECOND,".-active"));if(h){n.scrollTop=h.offsetTop-12}}}),CHI_TIME_AUTO_SCROLL_DELAY)};t.prototype.handleDateChange=function(t){t.stopPropagation();var i=t.detail;if(this.mode==="date"){this.value=i;this._input.value=i}if(this.mode==="datetime"&&this.time){var s=this.formatTime(this.time);this.value="".concat(i,", ").concat(s);this._input.value=this.value}if(!this.multiple){this.active=false;this._input.blur()}this.eventChange.emit(this.value)};t.prototype.handleTimeChange=function(t){t.stopPropagation();if(t.detail){var i=t.detail,s=i.hour,e=i.minute,n=i.second,a=i.period;this.time={hour:parseInt(s),minute:parseInt(e),second:parseInt(n),period:a}}if(!this.value){return}var h=this._getChiDateValue();var r=this.formatTime(t.detail);this.value="".concat(h,", ").concat(r);this.eventChange.emit(this.value)};t.prototype.formatTime=function(t){var i=this.timeFormat==="12hr"&&t.hour>12?t.hour-12:t.hour;var s=this.formatTimePeriod(i);var e=this.formatTimePeriod(t.minute);var n=this.displaySeconds?":".concat(this.formatTimePeriod(t.second)):"";return this.timeFormat==="12hr"?"".concat(s,":").concat(e).concat(n," ").concat(t.period):"".concat(s,":").concat(e).concat(n)};t.prototype.formatTimePeriod=function(t){return t.toString().length>1?t.toString():"0".concat(t)};t.prototype.connectedCallback=function(){addMutationObserver.call(this)};t.prototype.componentWillLoad=function(){this.stateValidation(this.state);this.updateExcludedDates();this.updateExcludedWeekdays();this._onFocusIn=this._onFocusIn.bind(this);this._onClick=this._onClick.bind(this);this._onKeyUp=this._onKeyUp.bind(this);this._uuid=this.el.id?this.el.id:"dp-".concat(v4())};t.prototype.componentDidLoad=function(){document.body.addEventListener("focusin",this._onFocusIn);document.body.addEventListener("click",this._onClick);document.body.addEventListener("keyup",this._onKeyUp)};t.prototype.disconnectedCallback=function(){document.body.removeEventListener("focusin",this._onFocusIn);document.body.removeEventListener("click",this._onClick);document.body.removeEventListener("keyup",this._onKeyUp)};t.prototype._getChiDateValue=function(){var t=this.value;if(this.mode==="datetime"){t=this.value?this.value.split(", ")[0]:null}return t};t.prototype._getPlaceholder=function(){if(this.mode!=="datetime"){return this.format}var t=this.displaySeconds?"--:--:--":"--:--";var i=this.timeFormat==="12hr"?" --":"";return"".concat(this.format,", ").concat(t).concat(i)};t.prototype.render=function(){var t=this;var i;var s=this._getChiDateValue();var e=h("chi-date",{key:"d02f3273a1e2da9b191d580852a21600f55a9de6",min:this.min,max:this.max,locale:this.locale,value:s,format:this.format,"excluded-weekdays":this.excludedWeekdays,"excluded-dates":this.excludedDates,multiple:this.multiple,onChiDateChange:function(i){return t.handleDateChange(i)}});var n=(((i=this.value)===null||i===void 0?void 0:i.split(", "))||[])[1];var a=this.mode==="datetime"?h("chi-time",{displaySeconds:this.displaySeconds,format:this.timeFormat,value:n,"minutes-step":this.minutesStep,onChiTimeChange:function(i){return t.handleTimeChange(i)}}):null;var r=this.mode==="datetime"?h("div",{class:"-d--flex"},e,a):e;var c=h("chi-popover",{key:"5d36986bd36d252097b2d7aaa66e15c3314dfab0",id:"example-4-be-popover",position:this.mode==="datetime"?"bottom-start":"bottom",reference:"#".concat(this._uuid,"-control"),"prevent-auto-hide":true,active:this.active},r);var o="chi-input\n      ".concat(this.active?"-focus":"","\n      ").concat(this.state?"-"+this.state:"","\n    ");var u=this.helperMessage&&h("chi-helper-message",{key:"aec98faf38cc67f1b4c26f5397a56998b20a8372",state:this.state},this.helperMessage);return[h("div",{class:"\n        ".concat(this.disabled?"-disabled":"","\n        ").concat(this.mode==="datetime"?"-time":""),key:this._uuid},h("div",{key:"fcfeb095fa4b43ea11c17c55a63489b1c2a5dfe8",class:"chi-input__wrapper -icon--right"},h("input",{key:"d4df8558ca931ead255aa059dfb855a2b2dd716a",id:"".concat(this._uuid,"-control"),class:o,type:"text",placeholder:this._getPlaceholder(),ref:function(i){return t._input=i},value:this.value&&this.multiple?String(this.value).replace(/,/g,", "):this.value,onChange:function(){t._checkDate()},disabled:this.disabled}),h("chi-icon",{key:"1f70a6449585c1d899ed753f4c40e5a32f5e9f96",icon:"date"})),u,!this.disabled&&c)]};Object.defineProperty(t.prototype,"el",{get:function(){return getElement(this)},enumerable:false,configurable:true});Object.defineProperty(t,"watchers",{get:function(){return{state:["stateValidation"],excludedDates:["updateExcludedDates"],excludedWeekdays:["updateExcludedWeekdays"]}},enumerable:false,configurable:true});return t}();export{DatePicker as chi_date_picker};