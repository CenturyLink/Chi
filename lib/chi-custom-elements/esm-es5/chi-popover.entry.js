var __awaiter=this&&this.__awaiter||function(t,i,e,n){function s(t){return t instanceof e?t:new e((function(i){i(t)}))}return new(e||(e=Promise))((function(e,r){function o(t){try{a(n.next(t))}catch(t){r(t)}}function h(t){try{a(n["throw"](t))}catch(t){r(t)}}function a(t){t.done?e(t.value):s(t.value).then(o,h)}a((n=n.apply(t,i||[])).next())}))};var __generator=this&&this.__generator||function(t,i){var e={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},n,s,r,o;return o={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(o[Symbol.iterator]=function(){return this}),o;function h(t){return function(i){return a([t,i])}}function a(h){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,h[0]&&(e=0)),e)try{if(n=1,s&&(r=h[0]&2?s["return"]:h[0]?s["throw"]||((r=s["return"])&&r.call(s),0):s.next)&&!(r=r.call(s,h[1])).done)return r;if(s=0,r)h=[h[0]&2,r.value];switch(h[0]){case 0:case 1:r=h;break;case 4:e.label++;return{value:h[1],done:false};case 5:e.label++;s=h[1];h=[0];continue;case 7:h=e.ops.pop();e.trys.pop();continue;default:if(!(r=e.trys,r=r.length>0&&r[r.length-1])&&(h[0]===6||h[0]===2)){e=0;continue}if(h[0]===3&&(!r||h[1]>r[0]&&h[1]<r[3])){e.label=h[1];break}if(h[0]===6&&e.label<r[1]){e.label=r[1];r=h;break}if(r&&e.label<r[2]){e.label=r[2];e.ops.push(h);break}if(r[2])e.ops.pop();e.trys.pop();continue}h=i.call(t,e)}catch(t){h=[6,t];s=0}finally{n=r=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:true}}};import{r as registerInstance,c as createEvent,h,g as getElement,H as Host}from"./index-422a57bb.js";import{a as CARDINAL_EXTENDED_POSITIONS}from"./positions-82cba14e.js";import{T as ThreeStepsAnimation}from"./ThreeStepsAnimation-a718d5b8.js";import{c as CLASSES,A as ANIMATION_DURATION,E as ESCAPE_KEYCODE}from"./constants-e61c7d0c.js";import{P as Popper}from"./popper-8e2de18f.js";import{a3 as POPOVER_CLASSES}from"./classes-d4369523.js";import{a as addMutationObserver}from"./mutationObserver-46245962.js";var Drag=function(){function t(t,i,e){var n=this;this.positionInitial={x:0,y:0};this.positionEnd={x:0,y:0};this.screenWidth=this.setScreenWidth();this.screenHeight=this.setScreenHeight();this.auxClientCoord=Number.MAX_SAFE_INTEGER;this.auxClientCoord2=Number.MIN_SAFE_INTEGER;this.dragMouseDownHandler=function(t){t.preventDefault();n.positionInitial.x=t.clientX;n.positionInitial.y=t.clientY;n.initialTransformStyling=window.getComputedStyle(n.elementToMove)["transform"];document.addEventListener("mouseup",n.closeDragElement);document.addEventListener("mousemove",n.elementDragHandler)};this.dragTouchHandler=function(t){t.preventDefault();n.positionInitial.x=t.touches[0].clientX;n.positionInitial.y=t.touches[0].clientY;n.initialTransformStyling=window.getComputedStyle(n.elementToMove)["transform"];n.trigger.addEventListener("touchmove",n.elementDragOnTouchHandler)};this.setPosition=function(t,i,e){n.positionEnd.x=n.positionInitial.x-t;n.positionEnd.y=n.positionInitial.y-i;n.positionInitial.x=t;n.positionInitial.y=i;n.elementToMove.style.transform=n.initialTransformStyling;if(e.top<0&&n.auxClientCoord>i){n.auxClientCoord=i}else if(e.left<0&&n.auxClientCoord>t){n.auxClientCoord=t}else if(e.right>n.screenWidth&&n.auxClientCoord2<t){n.auxClientCoord2=t}else if(e.bottom>n.screenHeight&&n.auxClientCoord2<i){n.auxClientCoord2=i}else{n.elementToMove.style.top=n.elementToMove.offsetTop-n.positionEnd.y+"px";n.elementToMove.style.left=n.elementToMove.offsetLeft-n.positionEnd.x+"px";n.auxClientCoord=Number.MAX_SAFE_INTEGER;n.auxClientCoord2=Number.MIN_SAFE_INTEGER}};this.elementDragHandler=function(t){t.preventDefault();if(n.component._popper){n.component._popper.destroy();n.component._popper=null}if(!n.elementToMove){return}var i=n.elementToMove.getBoundingClientRect();n.setPosition(t.clientX,t.clientY,i)};this.elementDragOnTouchHandler=function(t){t.preventDefault();var i=t.targetTouches[0];if(n.component._popper){n.component._popper.destroy();n.component._popper=null}if(!n.elementToMove){return}var e=n.elementToMove.getBoundingClientRect();n.setPosition(i.clientX,i.clientY,e)};this.closeDragElement=function(){document.removeEventListener("mouseup",n.closeDragElement);document.removeEventListener("mousemove",n.elementDragHandler)};this.handlerResize=function(){if(!n.elementToMove){return}var t=n.elementToMove.getBoundingClientRect();n.screenWidth=n.setScreenWidth();n.screenHeight=n.setScreenHeight();if(t.right>=n.screenWidth){n.elementToMove.style.left=Math.abs(t.width+t.width/2-n.screenWidth)+"px"}else if(t.bottom>=n.screenHeight){n.elementToMove.style.top=Math.abs(t.height*2-n.screenHeight)+"px"}};this.trigger=t;this.elementToMove=i;this.component=e;this.trigger.addEventListener("mousedown",this.dragMouseDownHandler);this.trigger.addEventListener("touchstart",this.dragTouchHandler);window.addEventListener("resize",this.handlerResize)}t.prototype.setScreenWidth=function(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth};t.prototype.setScreenHeight=function(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight};t.prototype.dispose=function(){document.removeEventListener("mouseup",this.closeDragElement);document.removeEventListener("mousemove",this.elementDragHandler);window.removeEventListener("resize",this.handlerResize);this.trigger=null;this.elementToMove=null;this.initialTransformStyling=null;this.positionEnd=null;this.positionInitial=null};return t}();var popoverCss="chi-popover.sc-chi-popover-h{display:inline-block}";var ChiPopoverStyle0=popoverCss;var Popover=function(){function t(t){registerInstance(this,t);this.eventShow=createEvent(this,"chiPopoverShow",7);this.eventHide=createEvent(this,"chiPopoverHide",7);this.eventShown=createEvent(this,"chiPopoverShown",7);this.eventHidden=createEvent(this,"chiPopoverHidden",7);this.position="top";this.closable=false;this.drag=false;this._animationClasses="";this._componentLoaded=false;this._didUpdateCallBackOnceQueue=[];this._closePrevented=false}t.prototype.positionValidation=function(t){if(t&&!CARDINAL_EXTENDED_POSITIONS.includes(t)){throw new Error("Not valid position ".concat(t," for popover. Valid values are top, top-start, top-end, right, right-start, right-end, bottom, bottom-start, bottom-end, left, left-start and left-end. "))}if(this._componentLoaded){this._configurePopoverPopper()}};t.prototype.referenceElementChanged=function(t){Popover.referenceElementValidation(t);this._reference=t?document.querySelector(t):null;if(this._componentLoaded){this._configurePopoverPopper()}};t.referenceElementValidation=function(t){if(t){var i=document.querySelectorAll(t);if(i.length===0){throw new Error("Reference element could not be found.")}if(i.length>1){throw new Error("Found ".concat(i.length," reference candidates matching ").concat(t,". Not able to discern which one is the preferred."))}}};t.prototype.arrowChanged=function(t,i){if(!!t!==!!i&&this._componentLoaded){this._configurePopoverPopper()}};t.prototype.statusChanged=function(t,i){if(!!t!==!!i){if(t){this.preventAutoClose();this._show()}else{this._hide()}}};t.prototype.dragUpdated=function(t){if(t&&!this._drag){this._drag=new Drag(this._popoverHeader,this._popoverElement,this)}else if(!t&&this._drag){this._drag.dispose();this._drag=undefined}};t.prototype.toggle=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){if(this.active){this.hide()}else{this.show()}return[2]}))}))};t.prototype.show=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){this.active=true;return[2]}))}))};t.prototype.hide=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){this.active=false;return[2]}))}))};t.prototype._resetPopperPosition=function(){this._popper.update()};t.prototype._show=function(){var t=this;if(!this._popper)this._initializePopper();if(this.currentAnimation&&!this.currentAnimation.isStopped()){this.currentAnimation.stop()}this._animationClasses=CLASSES.TRANSITIONING;this._didUpdateCallBackOnceQueue.push((function(){var i=t._popoverElement.style.transition;t._popoverElement.style.transition="none";t._resetPopperPosition();t.currentAnimation=ThreeStepsAnimation.animationFactory((function(){t._popoverElement.style.transform=t._preAnimationTransformStyle}),(function(){t._animationClasses="".concat(CLASSES.TRANSITIONING," ").concat(CLASSES.ACTIVE);t._popoverElement.style.transition=i;t._popoverElement.style.transform=t._postAnimationTransformStyle}),(function(){t._animationClasses=CLASSES.ACTIVE;t.eventShown.emit()}),ANIMATION_DURATION.SHORT)}));this.eventShow.emit()};t.prototype._hide=function(){var t=this;if(this.currentAnimation&&!this.currentAnimation.isStopped()){this.currentAnimation.stop()}this.currentAnimation=ThreeStepsAnimation.animationFactory((function(){t._animationClasses="".concat(CLASSES.TRANSITIONING," ").concat(CLASSES.ACTIVE)}),(function(){t._animationClasses=CLASSES.TRANSITIONING;t._popoverElement.style.transform=t._preAnimationTransformStyle}),(function(){t._animationClasses="";if(!t._popper){t._initializePopper()}t.eventHidden.emit()}),ANIMATION_DURATION.SHORT);this.eventHide.emit()};t.prototype._configurePopoverPopper=function(){if(!this._reference){if(this._popper){this._popper.destroy();this._popper=null}return}this._initializePopper();this._popper.update()};t.prototype._initializePopper=function(){var t=this;var i=function(i){t._preAnimationTransformStyle=null;t._postAnimationTransformStyle=i.styles.transform;if(i.placement.indexOf("top")===0){t._preAnimationTransformStyle="translate3d(".concat(i.popper.left,"px, ").concat(i.popper.top+20,"px, 0)")}else if(i.placement.indexOf("right")===0){t._preAnimationTransformStyle="translate3d(".concat(i.popper.left-20,"px, ").concat(i.popper.top,"px, 0)")}else if(i.placement.indexOf("bottom")===0){t._preAnimationTransformStyle="translate3d(".concat(i.popper.left,"px, ").concat(i.popper.top-20,"px, 0)")}else if(i.placement.indexOf("left")===0){t._preAnimationTransformStyle="translate3d(".concat(i.popper.left+20,"px, ").concat(i.popper.top,"px, 0)")}else{t._preAnimationTransformStyle=i.styles.transform}return i};this._popper=new Popper(this._reference,this._popoverElement,{modifiers:{applyStyle:{enabled:true},applyChiStyle:{enabled:true,fn:i,order:875},arrow:{element:".".concat(POPOVER_CLASSES.ARROW),enabled:this.arrow},preventOverflow:{boundariesElement:"window"}},removeOnDestroy:false,placement:this.position})};t.prototype._destroyPopper=function(){this._preAnimationTransformStyle=null;this._postAnimationTransformStyle=null;if(this._popper){this._popper.destroy();this._popper=null}};t.prototype.connectedCallback=function(){addMutationObserver.call(this,undefined,{childList:true,subtree:true})};t.prototype.componentWillLoad=function(){this.positionValidation(this.position);this.referenceElementChanged(this.reference);if(this.active){this._animationClasses=CLASSES.ACTIVE}if(Array.from(this.el.querySelectorAll("[slot=".concat(POPOVER_CLASSES.FOOTER,"]"))).length>0){this.popoverFooter=true}};t.prototype.componentDidLoad=function(){var t=this;this._documentClickHandler=function(){if(!t._closePrevented&&!t.preventAutoHide){t.hide()}};this._documentKeyHandler=function(i){if(!t.preventAutoHide&&"key"in i&&(i.key==="Escape"||i.key==="Esc"||i.key===ESCAPE_KEYCODE)){t.hide()}};this._configurePopoverPopper();this._componentLoaded=true;if(this.drag){this.dragUpdated(this.drag)}else{document.addEventListener("click",this._documentClickHandler);document.addEventListener("keyup",this._documentKeyHandler)}};t.prototype.disconnectedCallback=function(){this._destroyPopper();if(this.currentAnimation&&!this.currentAnimation.isStopped()){this.currentAnimation.stop()}if(this._drag){this._drag.dispose();this._drag=undefined}this.currentAnimation=null;this._componentLoaded=false;document.removeEventListener("click",this._documentClickHandler);document.removeEventListener("keyup",this._documentKeyHandler)};t.prototype.componentDidUpdate=function(){while(this._didUpdateCallBackOnceQueue.length){var t=this._didUpdateCallBackOnceQueue.shift();t()}};t.prototype.preventAutoClose=function(){var t=this;this._closePrevented=true;window.clearTimeout(this._closePreventedTimeout);this._closePreventedTimeout=window.setTimeout((function(){t._closePrevented=false}),100)};t.prototype.hostData=function(){return{"aria-hidden":this.active?"false":"true"}};t.prototype.__stencil_render=function(){var t=this;var i=this.closable?h("chi-button",{size:"xs",onClick:function(){return t.hide()},type:"close"}):null;var e=this.popoverTitle&&h("header",{key:"f8d4e6264b68beda229165cf36dcb4a1be874b2d",ref:function(i){return t._popoverHeader=i},class:POPOVER_CLASSES.HEADER},h("h2",{key:"1f5ce74f43d93f58890d09a10551687aabf9d979",class:POPOVER_CLASSES.TITLE},this.popoverTitle));var n=this.variant&&this.variant==="text"?h("p",{class:POPOVER_CLASSES.TEXT},h("slot",null)):h("slot",null);var s=this.popoverFooter&&h("div",{key:"b8af9d1d244c39d3acaae05bfdea6f9ce1068f75",class:POPOVER_CLASSES.FOOTER},h("slot",{key:"cda8cadc72598865da889afcd3fc5c22149973ac",name:POPOVER_CLASSES.FOOTER}));return h("section",{key:"80f7cc58ae33e683a8a074de76ac98752207e207",class:"\n          ".concat(POPOVER_CLASSES.POPOVER,"\n          ").concat(CLASSES.ANIMATED,"\n          ").concat(this.position?"chi-popover--".concat(this.position):"","\n          ").concat(this.arrow?"":POPOVER_CLASSES.NO_ARROW,"\n          ").concat(this._animationClasses,"\n          ").concat(this._reference&&this._reference.classList.contains("chi-input")?POPOVER_CLASSES.INPUT:"","\n          ").concat(this.closable?POPOVER_CLASSES.CLOSABLE:"","\n          ").concat(this.drag?POPOVER_CLASSES.DRAGGABLE:"","\n          ").concat(this.portal?"-portal":"","\n          ").concat(this.modal?POPOVER_CLASSES.MODAL:"","\n        "),ref:function(i){return t._popoverElement=i},onClick:function(){return t.preventAutoClose()},role:"dialog","aria-modal":"true","aria-label":this.popoverTitle,"aria-hidden":!this.active},i,e,h("div",{key:"5e7c321a64b5b8761bd07666d531df57d35ebf40",class:POPOVER_CLASSES.CONTENT},n),s,this.arrow&&h("div",{key:"821d2056c7465a1489c970f9c81d372a5695a8b6",class:POPOVER_CLASSES.ARROW}))};Object.defineProperty(t.prototype,"el",{get:function(){return getElement(this)},enumerable:false,configurable:true});Object.defineProperty(t,"watchers",{get:function(){return{position:["positionValidation"],reference:["referenceElementChanged"],arrow:["arrowChanged"],active:["statusChanged"],drag:["dragUpdated"]}},enumerable:false,configurable:true});t.prototype.render=function(){return h(Host,this.hostData(),this.__stencil_render())};return t}();Popover.style=ChiPopoverStyle0;export{Popover as chi_popover};