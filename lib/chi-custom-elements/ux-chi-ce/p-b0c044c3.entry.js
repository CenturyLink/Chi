import{r as t,c as s,h as i,g as e}from"./p-99c091ba.js";import{g as h,U as r,h as n,i as c}from"./p-c6d5045e.js";import{v as o}from"./p-d1e6806c.js";const l=class{constructor(i){t(this,i),this.eventValueChanged=s(this,"chiDropdownValueChanged",7),this.active=!1,this.button="Open dropdown",this.search=!1,this.showSelected=!1,this.multiple=!1,this.disabled=!1,this.currentItems=[],this.filteredItems=[],this.searchValue="",this.showSelectedOnly=!1,this.id=o(),this.currentDirtyItems=[],this.isSearchMode=this.search||this.showSelected}componentDidLoad(){this.isSearchMode&&(this.dropdownElement.retainSelection=!1),this.addSearchInputListeners(),this.addCheckboxListeners()}addSearchInputListeners(){this.searchInputElement=this.el.querySelector("chi-search-input"),this.searchInputElement&&(this.handleSearchInput=t=>{this.searchValue=t.detail,this.applyFilters()},this.handleSearchClean=()=>{this.searchValue="",this.applyFilters()},this.searchInputElement.addEventListener("chiInput",this.handleSearchInput),this.searchInputElement.addEventListener("chiClean",this.handleSearchClean))}addCheckboxListeners(){this.selectOnlyCheckbox=this.el.querySelector("#checkbox-select"),this.selectOnlyCheckbox&&(this.handleCheckboxChange=t=>{this.showSelectedOnly=t.detail,this.applyFilters()},this.selectOnlyCheckbox.addEventListener("chiChange",this.handleCheckboxChange))}componentWillLoad(){this.setCurrentDirtyItems()}disconnectedCallback(){this.searchInputElement&&(this.searchInputElement.removeEventListener("chiInput",this.handleSearchInput),this.searchInputElement.removeEventListener("chiClean",this.handleSearchClean)),this.selectOnlyCheckbox&&this.selectOnlyCheckbox.removeEventListener("chiChange",this.handleCheckboxChange)}setCurrentDirtyItems(){var t,s;this.currentDirtyItems=null!==(s=null===(t=this.items)||void 0===t?void 0:t.map(((t,s)=>Object.assign(Object.assign({},t),{id:t.id||this.id+"-"+s}))))&&void 0!==s?s:[],this.applyFilters()}resetFilters(){this.searchValue="",this.searchInputElement&&(this.searchInputElement.value=""),this.showSelectedOnly=!1,this.selectOnlyCheckbox&&this.selectOnlyCheckbox.removeAttribute("checked"),this.filteredItems=[...this.currentDirtyItems]}applyFilters(){const t=this.searchValue||"",s=t.toLowerCase();this.filteredItems=this.currentDirtyItems.filter((i=>{const e=i.label.toLowerCase();return(""===t||e.includes(s))&&(!this.showSelectedOnly||i.checked)}))}handleItemClick(t,s){t.stopPropagation(),s.checked=!s.checked,this.showSelectedOnly&&this.applyFilters()}handleApply(){this.dropdownElement.hide(),this.currentItems=this.currentDirtyItems.filter((t=>t.checked)),this.resetFilters(),this.eventValueChanged.emit(this.currentDirtyItems)}handleClear(){Array.from(this.el.querySelectorAll(`${h.checkbox}[checked]`)).forEach((t=>t.removeAttribute("checked"))),this.currentDirtyItems.forEach((t=>t.checked=!1)),this.showSelectedOnly=!1,this.applyFilters(),this.eventValueChanged.emit(this.currentDirtyItems)}getButtonContent(){return this.currentItems.length?`(${this.currentItems.length}) ${this.button}`:this.button}renderItems(){return this.isSearchMode&&this.currentDirtyItems.length?this.filteredItems.length?this.renderFilteredItems():this.renderNoResults():null}renderNoResults(){return i("div",{slot:"menu",class:`${n.MENU_ITEM} ${r.TYPOGRAPHY.TEXT_ITALIC}`},"No results")}renderFilteredItems(){return this.filteredItems.map((t=>this.renderCheckbox(t)))}renderCheckbox(t){return i("chi-checkbox",{label:t.label,class:n.MENU_ITEM,checked:t.checked||null,name:`${this.id}-group`,id:t.id,key:t.id,slot:"menu",onChiChange:s=>this.handleItemClick(s,t)})}renderSearchModeFooter(){if(!this.filteredItems.length)return null;const t=[r.DISPLAY.FLEX,r.JUSTIFY.END,r.PADDING[1],r.PADDING.RIGHT[2]].join(" ");return[i("div",{slot:"menu-footer",class:c.DIVIDER}),i("div",{slot:"menu-footer",class:t},i("chi-button",{size:"xs",class:r.MARGIN.RIGHT[1],onClick:()=>this.handleClear()},"Clear"),i("chi-button",{size:"xs",color:"primary",onClick:()=>this.handleApply()},"Apply"))]}renderSearchModeElements(){return this.isSearchMode?[this.search&&i("chi-search-input",{placeholder:"Search",slot:"menu-header"}),this.showSelected&&i("chi-checkbox",{class:n.MENU_ITEM,slot:"menu-header",id:"checkbox-select",label:"Show selected only"}),i("div",{class:"chi-divider",slot:"menu-header"})].filter(Boolean):null}resetDirtyItems(){this.resetFilters();const t=this.currentItems.map((t=>t.id));this.currentDirtyItems.forEach((s=>{const i=document.getElementById(s.id),e=t.includes(s.id);s.checked=e,i&&(e?i.setAttribute("checked",""):i.removeAttribute("checked"))}))}renderSlots(){return[i("slot",{name:"menu-header"}),i("slot",{name:"menu"}),i("slot",{name:"menu-footer"})]}render(){const t={id:this.id,active:this.active,disabled:this.disabled,size:this.size,state:this.state,visibleItems:this.visibleItems,helperMessage:this.helperMessage,button:this.getButtonContent()};return i("chi-dropdown",Object.assign({key:"dab6939fae57fb9e6236ff3093e83b13a54de743"},t,{preventAutoHide:this.isSearchMode,preventItemSelected:this.isSearchMode,"select-mode":this.isSearchMode||this.multiple?"multi":"single",onChiDropdownHide:()=>this.isSearchMode&&this.resetDirtyItems(),onChiDropdownValueChanged:t=>this.isSearchMode&&t.stopPropagation()},{ref:t=>this.dropdownElement=t}),this.renderSearchModeElements(),this.renderItems(),this.renderSearchModeFooter(),this.renderSlots())}get el(){return e(this)}static get watchers(){return{items:["setCurrentDirtyItems"]}}};export{l as chi_dropdown_select}