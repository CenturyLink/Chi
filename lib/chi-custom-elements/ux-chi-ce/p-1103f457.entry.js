import{r as t,c as i,h as s,g as h}from"./p-1fb7f4e7.js";import{c as e}from"./p-834de5c7.js";import{E as a,b as c}from"./p-3c5e39a4.js";import{d,c as n}from"./p-31692605.js";import{d as o}from"./p-70488c96.js";import{C as r}from"./p-1ad0e10c.js";import{a as l}from"./p-3d620cf0.js";import{v as u}from"./p-c4c32c46.js";const p=class{constructor(s){t(this,s),this.eventChange=i(this,"chiDateChange",7),this.eventInvalid=i(this,"chiDateInvalid",7),this.locale="en",this.min="01/01/1900",this.max="12/31/2099",this.format="MM/DD/YYYY",this.disabled=!1,this.active=!1,this.mode="date",this.multiple=!1,this.timeFormat="12hr",this.displaySeconds=!1,this.excludedWeekdaysArray=[],this.excludedDatesArray=[]}stateValidation(t){const i=r.join(", ");if(t&&!r.includes(t))throw new Error(`${t} is not a valid state for date picker. If provided, valid values are: ${i}. `)}updateExcludedDates(){this.excludedDatesArray=this.excludedDates?this.excludedDates.split(",").map((t=>t.trim())):[]}updateExcludedWeekdays(){this.excludedWeekdaysArray=this.excludedWeekdays?this.excludedWeekdays.split(",").map((t=>parseInt(t))):[]}_onFocusIn(t){t.target!==document.body&&null!==t.target&&(this.active=e(this.el,t.target))}_onClick(t){t.target===document.body||null===t.target||"datetime"!==this.mode&&!this.multiple&&new RegExp("(\\s|^)chi-datepicker__day(\\s|$)").test(t.target.getAttribute("class"))||(this.active=e(this.el,t.target))}_isEscapeKey(t){return"key"in t&&("Escape"===t.key||"Esc"===t.key||t.key===a)}_onKeyUp(t){this.active&&this._isEscapeKey(t)&&(this.active=!1,this._input.blur())}checkIfExcluded(t){return this.excludedDates&&this.excludedDatesArray.some((i=>d(i).startOf("day").isSame(t.startOf("day"))))||this.excludedWeekdays&&this.excludedWeekdaysArray.includes(t.day())}_checkValidDate(t,i,s){const h=d(t,this.format);return h.isValid()&&!this.checkIfExcluded(h)&&!h.startOf("day").isBefore(d(i).startOf("day"))&&!h.startOf("day").isAfter(d(s).startOf("day"))}_checkMultipleDates(t,i){const s=this._input.value.replace(/ /g,"").split(","),h=[];s.forEach((s=>{this._checkValidDate(s,t,i)&&!h.includes(s)&&h.push(s)})),this.value=h.join(","),this._input.value=this.value,this.eventChange.emit(this.value)}_checkSingleDate(t,i){const s=d(this._input.value,this.format),h="datetime"===this.mode,e=h?this._input.value.split(", ")[1]:"",a=h?this._input.value.split(", ")[0]:this._input.value;d(a,this.format,!0).isValid()&&!this.checkIfExcluded(s)?d(s).startOf("day").isBefore(d(t).startOf("day"))?(this.value=e?`${this.min}, ${e}`:this.min,this._input.value=this.value,this.eventChange.emit(this.value)):d(s).startOf("day").isAfter(d(i).startOf("day"))?(this.value=e?`${this.max}, ${e}`:this.max,this._input.value=this.value,this.eventChange.emit(this.value)):(this.value=this._input.value,this.eventChange.emit(this.value)):(this.eventInvalid.emit(this._input.value),this.value="",this._input.value="")}_checkDate(){d.locale(this.locale),d.extend(n);const t=d(this.min,this.format),i=d(this.max,this.format);this._input.value!==this.value&&(this.multiple?this._checkMultipleDates(t,i):this._checkSingleDate(t,i))}async setDate(t){this.value=t}async resetDate(){this.value=null}getDate(){return Promise.resolve(this.value)}handlePopoverOpen(t){t.stopPropagation();const i=this.el.querySelector(`.${o.HOURS}`),s=this.el.querySelector(`.${o.MINUTES}`),h=this.el.querySelector(`.${o.SECONDS}`);setTimeout((()=>{if(i){const t=i.querySelector(`.${o.HOUR}.-active`);t&&(i.scrollTop=t.offsetTop-12)}if(s){const t=s.querySelector(`.${o.MINUTE}.-active`);t&&(s.scrollTop=t.offsetTop-12)}if(this.displaySeconds&&h){const t=h.querySelector(`.${o.SECOND}.-active`);t&&(h.scrollTop=t.offsetTop-12)}}),c)}handleDateChange(t){t.stopPropagation();const i=t.detail;if("date"===this.mode&&(this.value=i,this._input.value=i),"datetime"===this.mode&&this.time){const t=this.formatTime(this.time);this.value=`${i}, ${t}`,this._input.value=this.value}this.multiple||(this.active=!1,this._input.blur()),this.eventChange.emit(this.value)}handleTimeChange(t){if(t.stopPropagation(),t.detail){const{hour:i,minute:s,second:h,period:e}=t.detail;this.time={hour:parseInt(i),minute:parseInt(s),second:parseInt(h),period:e}}if(!this.value)return;const i=this._getChiDateValue(),s=this.formatTime(t.detail);this.value=`${i}, ${s}`,this.eventChange.emit(this.value)}formatTime(t){const i=this.formatTimePeriod("12hr"===this.timeFormat&&t.hour>12?t.hour-12:t.hour),s=this.formatTimePeriod(t.minute),h=this.displaySeconds?`:${this.formatTimePeriod(t.second)}`:"";return"12hr"===this.timeFormat?`${i}:${s}${h} ${t.period}`:`${i}:${s}${h}`}formatTimePeriod(t){return t.toString().length>1?t.toString():`0${t}`}connectedCallback(){l.call(this)}componentWillLoad(){this.stateValidation(this.state),this.updateExcludedDates(),this.updateExcludedWeekdays(),this._onFocusIn=this._onFocusIn.bind(this),this._onClick=this._onClick.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this._uuid=this.el.id?this.el.id:`dp-${u()}`}componentDidLoad(){document.body.addEventListener("focusin",this._onFocusIn),document.body.addEventListener("click",this._onClick),document.body.addEventListener("keyup",this._onKeyUp)}disconnectedCallback(){document.body.removeEventListener("focusin",this._onFocusIn),document.body.removeEventListener("click",this._onClick),document.body.removeEventListener("keyup",this._onKeyUp)}_getChiDateValue(){let t=this.value;return"datetime"===this.mode&&(t=this.value?this.value.split(", ")[0]:null),t}_getPlaceholder(){return"datetime"!==this.mode?this.format:`${this.format}, ${this.displaySeconds?"--:--:--":"--:--"}${"12hr"===this.timeFormat?" --":""}`}render(){var t;const i=this._getChiDateValue(),h=s("chi-date",{key:"d02f3273a1e2da9b191d580852a21600f55a9de6",min:this.min,max:this.max,locale:this.locale,value:i,format:this.format,"excluded-weekdays":this.excludedWeekdays,"excluded-dates":this.excludedDates,multiple:this.multiple,onChiDateChange:t=>this.handleDateChange(t)}),e=((null===(t=this.value)||void 0===t?void 0:t.split(", "))||[])[1],a="datetime"===this.mode?s("chi-time",{displaySeconds:this.displaySeconds,format:this.timeFormat,value:e,"minutes-step":this.minutesStep,onChiTimeChange:t=>this.handleTimeChange(t)}):null,c="datetime"===this.mode?s("div",{class:"-d--flex"},h,a):h,d=s("chi-popover",{key:"5d36986bd36d252097b2d7aaa66e15c3314dfab0",id:"example-4-be-popover",position:"datetime"===this.mode?"bottom-start":"bottom",reference:`#${this._uuid}-control`,"prevent-auto-hide":!0,active:this.active},c),n=`chi-input\n      ${this.active?"-focus":""}\n      ${this.state?"-"+this.state:""}\n    `,o=this.helperMessage&&s("chi-helper-message",{key:"aec98faf38cc67f1b4c26f5397a56998b20a8372",state:this.state},this.helperMessage);return[s("div",{class:`\n        ${this.disabled?"-disabled":""}\n        ${"datetime"===this.mode?"-time":""}`,key:this._uuid},s("div",{key:"fcfeb095fa4b43ea11c17c55a63489b1c2a5dfe8",class:"chi-input__wrapper -icon--right"},s("input",{key:"d4df8558ca931ead255aa059dfb855a2b2dd716a",id:`${this._uuid}-control`,class:n,type:"text",placeholder:this._getPlaceholder(),ref:t=>this._input=t,value:this.value&&this.multiple?String(this.value).replace(/,/g,", "):this.value,onChange:()=>{this._checkDate()},disabled:this.disabled}),s("chi-icon",{key:"1f70a6449585c1d899ed753f4c40e5a32f5e9f96",icon:"date"})),o,!this.disabled&&d)]}get el(){return h(this)}static get watchers(){return{state:["stateValidation"],excludedDates:["updateExcludedDates"],excludedWeekdays:["updateExcludedWeekdays"]}}};export{p as chi_date_picker}