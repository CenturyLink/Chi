import{r as t,c as i,h as s,g as h,H as e}from"./p-0c0cd099.js";import{a as o}from"./p-eb9b9d80.js";import{T as n}from"./p-68882606.js";import{c as r,A as a,E as d}from"./p-baae1ad7.js";import{P as c}from"./p-c8326a28.js";import{$ as l}from"./p-ed8c4a28.js";import{a as p}from"./p-9cb46040.js";class u{setScreenWidth(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth}setScreenHeight(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}constructor(t,i,s){this.positionInitial={x:0,y:0},this.positionEnd={x:0,y:0},this.screenWidth=this.setScreenWidth(),this.screenHeight=this.setScreenHeight(),this.auxClientCoord=Number.MAX_SAFE_INTEGER,this.auxClientCoord2=Number.MIN_SAFE_INTEGER,this.dragMouseDownHandler=t=>{t.preventDefault(),this.positionInitial.x=t.clientX,this.positionInitial.y=t.clientY,this.initialTransformStyling=window.getComputedStyle(this.elementToMove).transform,document.addEventListener("mouseup",this.closeDragElement),document.addEventListener("mousemove",this.elementDragHandler)},this.dragTouchHandler=t=>{t.preventDefault(),this.positionInitial.x=t.touches[0].clientX,this.positionInitial.y=t.touches[0].clientY,this.initialTransformStyling=window.getComputedStyle(this.elementToMove).transform,this.trigger.addEventListener("touchmove",this.elementDragOnTouchHandler)},this.setPosition=(t,i,s)=>{this.positionEnd.x=this.positionInitial.x-t,this.positionEnd.y=this.positionInitial.y-i,this.positionInitial.x=t,this.positionInitial.y=i,this.elementToMove.style.transform=this.initialTransformStyling,s.top<0&&this.auxClientCoord>i?this.auxClientCoord=i:s.left<0&&this.auxClientCoord>t?this.auxClientCoord=t:s.right>this.screenWidth&&this.auxClientCoord2<t?this.auxClientCoord2=t:s.bottom>this.screenHeight&&this.auxClientCoord2<i?this.auxClientCoord2=i:(this.elementToMove.style.top=this.elementToMove.offsetTop-this.positionEnd.y+"px",this.elementToMove.style.left=this.elementToMove.offsetLeft-this.positionEnd.x+"px",this.auxClientCoord=Number.MAX_SAFE_INTEGER,this.auxClientCoord2=Number.MIN_SAFE_INTEGER)},this.elementDragHandler=t=>{if(t.preventDefault(),this.component._popper&&(this.component._popper.destroy(),this.component._popper=null),!this.elementToMove)return;const i=this.elementToMove.getBoundingClientRect();this.setPosition(t.clientX,t.clientY,i)},this.elementDragOnTouchHandler=t=>{t.preventDefault();const i=t.targetTouches[0];if(this.component._popper&&(this.component._popper.destroy(),this.component._popper=null),!this.elementToMove)return;const s=this.elementToMove.getBoundingClientRect();this.setPosition(i.clientX,i.clientY,s)},this.closeDragElement=()=>{document.removeEventListener("mouseup",this.closeDragElement),document.removeEventListener("mousemove",this.elementDragHandler)},this.handlerResize=()=>{if(!this.elementToMove)return;const t=this.elementToMove.getBoundingClientRect();this.screenWidth=this.setScreenWidth(),this.screenHeight=this.setScreenHeight(),t.right>=this.screenWidth?this.elementToMove.style.left=Math.abs(t.width+t.width/2-this.screenWidth)+"px":t.bottom>=this.screenHeight&&(this.elementToMove.style.top=Math.abs(2*t.height-this.screenHeight)+"px")},this.trigger=t,this.elementToMove=i,this.component=s,this.trigger.addEventListener("mousedown",this.dragMouseDownHandler),this.trigger.addEventListener("touchstart",this.dragTouchHandler),window.addEventListener("resize",this.handlerResize)}dispose(){document.removeEventListener("mouseup",this.closeDragElement),document.removeEventListener("mousemove",this.elementDragHandler),window.removeEventListener("resize",this.handlerResize),this.trigger=null,this.elementToMove=null,this.initialTransformStyling=null,this.positionEnd=null,this.positionInitial=null}}const m=class{constructor(s){t(this,s),this.eventShow=i(this,"chiPopoverShow",7),this.eventHide=i(this,"chiPopoverHide",7),this.eventShown=i(this,"chiPopoverShown",7),this.eventHidden=i(this,"chiPopoverHidden",7),this._componentLoaded=!1,this._didUpdateCallBackOnceQueue=[],this._closePrevented=!1,this.position="top",this.arrow=void 0,this.closable=!1,this.drag=!1,this.active=void 0,this.reference=void 0,this.portal=void 0,this.modal=void 0,this.preventAutoHide=void 0,this.variant=void 0,this._animationClasses="",this.popoverTitle=void 0,this.popoverFooter=void 0}positionValidation(t){if(t&&!o.includes(t))throw new Error(`Not valid position ${t} for popover. Valid values are top, top-start, top-end, right, right-start, right-end, bottom, bottom-start, bottom-end, left, left-start and left-end. `);this._componentLoaded&&this._configurePopoverPopper()}referenceElementChanged(t){m.referenceElementValidation(t),this._reference=t?document.querySelector(t):null,this._componentLoaded&&this._configurePopoverPopper()}static referenceElementValidation(t){if(t){const i=document.querySelectorAll(t);if(0===i.length)throw new Error("Reference element could not be found.");if(i.length>1)throw new Error(`Found ${i.length} reference candidates matching ${t}. Not able to discern which one is the preferred.`)}}arrowChanged(t,i){!!t!=!!i&&this._componentLoaded&&this._configurePopoverPopper()}statusChanged(t,i){!!t!=!!i&&(t?(this.preventAutoClose(),this._show()):this._hide())}dragUpdated(t){t&&!this._drag?this._drag=new u(this._popoverHeader,this._popoverElement,this):!t&&this._drag&&(this._drag.dispose(),this._drag=void 0)}async toggle(){this.active?this.hide():this.show()}async show(){this.active=!0}async hide(){this.active=!1}_resetPopperPosition(){this._popper.update()}_show(){this._popper||this._initializePopper(),this.currentAnimation&&!this.currentAnimation.isStopped()&&this.currentAnimation.stop(),this._animationClasses=r.TRANSITIONING,this._didUpdateCallBackOnceQueue.push((()=>{const t=this._popoverElement.style.transition;this._popoverElement.style.transition="none",this._resetPopperPosition(),this.currentAnimation=n.animationFactory((()=>{this._popoverElement.style.transform=this._preAnimationTransformStyle}),(()=>{this._animationClasses=`${r.TRANSITIONING} ${r.ACTIVE}`,this._popoverElement.style.transition=t,this._popoverElement.style.transform=this._postAnimationTransformStyle}),(()=>{this._animationClasses=r.ACTIVE,this.eventShown.emit()}),a.SHORT)})),this.eventShow.emit()}_hide(){this.currentAnimation&&!this.currentAnimation.isStopped()&&this.currentAnimation.stop(),this.currentAnimation=n.animationFactory((()=>{this._animationClasses=`${r.TRANSITIONING} ${r.ACTIVE}`}),(()=>{this._animationClasses=r.TRANSITIONING,this._popoverElement.style.transform=this._preAnimationTransformStyle}),(()=>{this._animationClasses="",this._popper||this._initializePopper(),this.eventHidden.emit()}),a.SHORT),this.eventHide.emit()}_configurePopoverPopper(){this._reference?(this._initializePopper(),this._popper.update()):this._popper&&(this._popper.destroy(),this._popper=null)}_initializePopper(){this._popper=new c(this._reference,this._popoverElement,{modifiers:{applyStyle:{enabled:!0},applyChiStyle:{enabled:!0,fn:t=>(this._preAnimationTransformStyle=null,this._postAnimationTransformStyle=t.styles.transform,this._preAnimationTransformStyle=0===t.placement.indexOf("top")?`translate3d(${t.popper.left}px, ${t.popper.top+20}px, 0)`:0===t.placement.indexOf("right")?`translate3d(${t.popper.left-20}px, ${t.popper.top}px, 0)`:0===t.placement.indexOf("bottom")?`translate3d(${t.popper.left}px, ${t.popper.top-20}px, 0)`:0===t.placement.indexOf("left")?`translate3d(${t.popper.left+20}px, ${t.popper.top}px, 0)`:t.styles.transform,t),order:875},arrow:{element:`.${l.ARROW}`,enabled:this.arrow},preventOverflow:{boundariesElement:"window"}},removeOnDestroy:!1,placement:this.position})}_destroyPopper(){this._preAnimationTransformStyle=null,this._postAnimationTransformStyle=null,this._popper&&(this._popper.destroy(),this._popper=null)}connectedCallback(){p.call(this,void 0,{childList:!0,subtree:!0})}componentWillLoad(){this.positionValidation(this.position),this.referenceElementChanged(this.reference),this.active&&(this._animationClasses=r.ACTIVE),Array.from(this.el.querySelectorAll(`[slot=${l.FOOTER}]`)).length>0&&(this.popoverFooter=!0)}componentDidLoad(){this._documentClickHandler=()=>{this._closePrevented||this.preventAutoHide||this.hide()},this._documentKeyHandler=t=>{this.preventAutoHide||!("key"in t)||"Escape"!==t.key&&"Esc"!==t.key&&t.key!==d||this.hide()},this._configurePopoverPopper(),this._componentLoaded=!0,this.drag?this.dragUpdated(this.drag):(document.addEventListener("click",this._documentClickHandler),document.addEventListener("keyup",this._documentKeyHandler))}disconnectedCallback(){this._destroyPopper(),this.currentAnimation&&!this.currentAnimation.isStopped()&&this.currentAnimation.stop(),this._drag&&(this._drag.dispose(),this._drag=void 0),this.currentAnimation=null,this._componentLoaded=!1,document.removeEventListener("click",this._documentClickHandler),document.removeEventListener("keyup",this._documentKeyHandler)}componentDidUpdate(){for(;this._didUpdateCallBackOnceQueue.length;)this._didUpdateCallBackOnceQueue.shift()()}preventAutoClose(){this._closePrevented=!0,window.clearTimeout(this._closePreventedTimeout),this._closePreventedTimeout=window.setTimeout((()=>{this._closePrevented=!1}),100)}hostData(){return{"aria-hidden":this.active?"false":"true"}}__stencil_render(){const t=this.closable?s("chi-button",{size:"xs",onClick:()=>this.hide(),type:"close"}):null,i=this.popoverTitle&&s("header",{key:"f8d4e6264b68beda229165cf36dcb4a1be874b2d",ref:t=>this._popoverHeader=t,class:l.HEADER},s("h2",{key:"1f5ce74f43d93f58890d09a10551687aabf9d979",class:l.TITLE},this.popoverTitle)),h=this.variant&&"text"===this.variant?s("p",{class:l.TEXT},s("slot",null)):s("slot",null),e=this.popoverFooter&&s("div",{key:"b8af9d1d244c39d3acaae05bfdea6f9ce1068f75",class:l.FOOTER},s("slot",{key:"cda8cadc72598865da889afcd3fc5c22149973ac",name:l.FOOTER}));return s("section",{key:"80f7cc58ae33e683a8a074de76ac98752207e207",class:`\n          ${l.POPOVER}\n          ${r.ANIMATED}\n          ${this.position?`chi-popover--${this.position}`:""}\n          ${this.arrow?"":l.NO_ARROW}\n          ${this._animationClasses}\n          ${this._reference&&this._reference.classList.contains("chi-input")?l.INPUT:""}\n          ${this.closable?l.CLOSABLE:""}\n          ${this.drag?l.DRAGGABLE:""}\n          ${this.portal?"-portal":""}\n          ${this.modal?l.MODAL:""}\n        `,ref:t=>this._popoverElement=t,onClick:()=>this.preventAutoClose(),role:"dialog","aria-modal":"true","aria-label":this.popoverTitle,"aria-hidden":!this.active},t,i,s("div",{key:"5e7c321a64b5b8761bd07666d531df57d35ebf40",class:l.CONTENT},h),e,this.arrow&&s("div",{key:"821d2056c7465a1489c970f9c81d372a5695a8b6",class:l.ARROW}))}get el(){return h(this)}static get watchers(){return{position:["positionValidation"],reference:["referenceElementChanged"],arrow:["arrowChanged"],active:["statusChanged"],drag:["dragUpdated"]}}render(){return s(e,this.hostData(),this.__stencil_render())}};m.style="chi-popover.sc-chi-popover-h{display:inline-block}";export{m as chi_popover}