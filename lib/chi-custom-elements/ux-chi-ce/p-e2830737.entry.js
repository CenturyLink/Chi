import{r as t,c as i,h as s,g as e}from"./p-99c091ba.js";import{c as h}from"./p-834de5c7.js";import{E as a,b as c}from"./p-3c5e39a4.js";import{d,c as n}from"./p-65e73661.js";import{f as o}from"./p-e680f502.js";import{C as r}from"./p-1ad0e10c.js";import{a as l}from"./p-f0aa53ea.js";import{v as u}from"./p-d1e6806c.js";const p=class{constructor(s){t(this,s),this.eventChange=i(this,"chiDateChange",7),this.eventInvalid=i(this,"chiDateInvalid",7),this.locale="en",this.min="01/01/1900",this.max="12/31/2099",this.format="MM/DD/YYYY",this.disabled=!1,this.active=!1,this.mode="date",this.multiple=!1,this.timeFormat="12hr",this.displaySeconds=!1,this.excludedWeekdaysArray=[],this.excludedDatesArray=[]}stateValidation(t){const i=r.join(", ");if(t&&!r.includes(t))throw new Error(`${t} is not a valid state for date picker. If provided, valid values are: ${i}. `)}updateExcludedDates(){this.excludedDatesArray=this.excludedDates?this.excludedDates.split(",").map((t=>t.trim())):[]}updateExcludedWeekdays(){this.excludedWeekdaysArray=this.excludedWeekdays?this.excludedWeekdays.split(",").map((t=>parseInt(t))):[]}_onFocusIn(t){t.target!==document.body&&null!==t.target&&(this.active=h(this.el,t.target))}_onClick(t){t.target===document.body||null===t.target||"datetime"!==this.mode&&!this.multiple&&new RegExp("(\\s|^)chi-datepicker__day(\\s|$)").test(t.target.getAttribute("class"))||(this.active=h(this.el,t.target))}_isEscapeKey(t){return"key"in t&&("Escape"===t.key||"Esc"===t.key||t.key===a)}_onKeyUp(t){this.active&&this._isEscapeKey(t)&&(this.active=!1,this._input.blur())}checkIfExcluded(t){return this.excludedDates&&this.excludedDatesArray.some((i=>d(i).startOf("day").isSame(t.startOf("day"))))||this.excludedWeekdays&&this.excludedWeekdaysArray.includes(t.day())}_checkValidDate(t,i,s){const e=d(t,this.format);return e.isValid()&&!this.checkIfExcluded(e)&&!e.startOf("day").isBefore(d(i).startOf("day"))&&!e.startOf("day").isAfter(d(s).startOf("day"))}_checkMultipleDates(t,i){const s=this._input.value.replace(/ /g,"").split(","),e=[];s.forEach((s=>{this._checkValidDate(s,t,i)&&!e.includes(s)&&e.push(s)})),this.value=e.join(","),this._input.value=this.value,this.eventChange.emit(this.value)}_checkSingleDate(t,i){const s=d(this._input.value,this.format),e="datetime"===this.mode,h=e?this._input.value.split(", ")[1]:"",a=e?this._input.value.split(", ")[0]:this._input.value;d(a,this.format,!0).isValid()&&!this.checkIfExcluded(s)?d(s).startOf("day").isBefore(d(t).startOf("day"))?(this.value=h?`${this.min}, ${h}`:this.min,this._input.value=this.value,this.eventChange.emit(this.value)):d(s).startOf("day").isAfter(d(i).startOf("day"))?(this.value=h?`${this.max}, ${h}`:this.max,this._input.value=this.value,this.eventChange.emit(this.value)):(this.value=this._input.value,this.eventChange.emit(this.value)):(this.eventInvalid.emit(this._input.value),this.value="",this._input.value="")}_checkDate(){d.locale(this.locale),d.extend(n);const t=d(this.min,this.format),i=d(this.max,this.format);this._input.value!==this.value&&(this.multiple?this._checkMultipleDates(t,i):this._checkSingleDate(t,i))}async setDate(t){this.value=t}async resetDate(){this.value=null}getDate(){return Promise.resolve(this.value)}handlePopoverOpen(t){t.stopPropagation();const i=this.el.querySelector(`.${o.HOURS}`),s=this.el.querySelector(`.${o.MINUTES}`),e=this.el.querySelector(`.${o.SECONDS}`);setTimeout((()=>{if(i){const t=i.querySelector(`.${o.HOUR}.-active`);t&&(i.scrollTop=t.offsetTop-12)}if(s){const t=s.querySelector(`.${o.MINUTE}.-active`);t&&(s.scrollTop=t.offsetTop-12)}if(this.displaySeconds&&e){const t=e.querySelector(`.${o.SECOND}.-active`);t&&(e.scrollTop=t.offsetTop-12)}}),c)}handleDateChange(t){t.stopPropagation();const i=t.detail;if("date"===this.mode&&(this.value=i,this._input.value=i),"datetime"===this.mode&&this.time){const t=this.formatTime(this.time);this.value=`${i}, ${t}`,this._input.value=this.value}this.multiple||(this.active=!1,this._input.blur()),this.eventChange.emit(this.value)}handleTimeChange(t){if(t.stopPropagation(),t.detail){const{hour:i,minute:s,second:e,period:h}=t.detail;this.time={hour:parseInt(i),minute:parseInt(s),second:parseInt(e),period:h}}if(!this.value)return;const i=this._getChiDateValue(),s=this.formatTime(t.detail);this.value=`${i}, ${s}`,this.eventChange.emit(this.value)}formatTime(t){const i=this.formatTimePeriod("12hr"===this.timeFormat&&t.hour>12?t.hour-12:t.hour),s=this.formatTimePeriod(t.minute),e=this.displaySeconds?`:${this.formatTimePeriod(t.second)}`:"";return"12hr"===this.timeFormat?`${i}:${s}${e} ${t.period}`:`${i}:${s}${e}`}formatTimePeriod(t){return t.toString().length>1?t.toString():`0${t}`}connectedCallback(){l.call(this)}componentWillLoad(){this.stateValidation(this.state),this.updateExcludedDates(),this.updateExcludedWeekdays(),this._onFocusIn=this._onFocusIn.bind(this),this._onClick=this._onClick.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this._uuid=this.el.id?this.el.id:`dp-${u()}`}componentDidLoad(){document.body.addEventListener("focusin",this._onFocusIn),document.body.addEventListener("click",this._onClick),document.body.addEventListener("keyup",this._onKeyUp)}disconnectedCallback(){document.body.removeEventListener("focusin",this._onFocusIn),document.body.removeEventListener("click",this._onClick),document.body.removeEventListener("keyup",this._onKeyUp)}_getChiDateValue(){let t=this.value;return"datetime"===this.mode&&(t=this.value?this.value.split(", ")[0]:null),t}_getPlaceholder(){return"datetime"!==this.mode?this.format:`${this.format}, ${this.displaySeconds?"--:--:--":"--:--"}${"12hr"===this.timeFormat?" --":""}`}render(){var t;const i=this._getChiDateValue(),e=s("chi-date",{key:"57e4928966e9e2f0c9fc024e51d5721c0b58e005",min:this.min,max:this.max,locale:this.locale,value:i,format:this.format,"excluded-weekdays":this.excludedWeekdays,"excluded-dates":this.excludedDates,multiple:this.multiple,onChiDateChange:t=>this.handleDateChange(t)}),h=((null===(t=this.value)||void 0===t?void 0:t.split(", "))||[])[1],a="datetime"===this.mode?s("chi-time",{displaySeconds:this.displaySeconds,format:this.timeFormat,value:h,"minutes-step":this.minutesStep,onChiTimeChange:t=>this.handleTimeChange(t)}):null,c="datetime"===this.mode?s("div",{class:"-d--flex"},e,a):e,d=s("chi-popover",{key:"2e5f4f441f8c1b0758e516f00782ba35357342ec",id:"example-4-be-popover",position:"datetime"===this.mode?"bottom-start":"bottom",reference:`#${this._uuid}-control`,"prevent-auto-hide":!0,active:this.active},c),n=`chi-input\n      ${this.active?"-focus":""}\n      ${this.state?"-"+this.state:""}\n    `,o=this.helperMessage&&s("chi-helper-message",{key:"eec0f83fcd03b01ba1c9869694853a964cad4b80",state:this.state},this.helperMessage);return[s("div",{class:`\n        ${this.disabled?"-disabled":""}\n        ${"datetime"===this.mode?"-time":""}`,key:this._uuid},s("div",{key:"562be008fe486421c6ff48b84a07b0931ae1c9cc",class:"chi-input__wrapper -icon--right"},s("input",{key:"46f63cf2a64895917ded9854f6336fc158c2e0f6",id:`${this._uuid}-control`,class:n,type:"text",placeholder:this._getPlaceholder(),ref:t=>this._input=t,value:this.value&&this.multiple?String(this.value).replace(/,/g,", "):this.value,onChange:()=>{this._checkDate()},disabled:this.disabled}),s("chi-icon",{key:"00d73873043e691f8d5b10f56a81ebb992ddc631",icon:"date"})),o,!this.disabled&&d)]}get el(){return e(this)}static get watchers(){return{state:["stateValidation"],excludedDates:["updateExcludedDates"],excludedWeekdays:["updateExcludedWeekdays"]}}};export{p as chi_date_picker}